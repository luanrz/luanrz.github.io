<!doctype html><html lang=zh dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>命令备忘录：Docker | luanrz's blog</title><meta name=keywords content="Linux,命令备忘录,Docker"><meta name=description content='Redis
docker run \
-d \
-p 127.0.0.1:6379:6379 \
--name=redis \
redis

docker-compose.yml

services:
  redis:
    image: redis
    container_name: redis
    ports:
      - "127.0.0.1:6379:6379"
Nginx
mkdir -p ./html/
mkdir -p ./conf.d/
mkdir -p ./log/

cat > ./html/index.html << EOF
Hello World!
EOF

cat > ./conf.d/default.conf << EOF
server {
    listen       80;
    location / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
    }
}
EOF
docker run \
-d \
-p 127.0.0.1:8014:80 \
--name=nginx \
-v ./html/:/usr/share/nginx/html/ \
-v ./conf.d/:/etc/nginx/conf.d/ \
-v ./log/:/var/log/nginx/ \
nginx:alpine

docker-compose.yml'><meta name=author content><link rel=canonical href=https://luanrz.github.io/posts/%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/%E5%91%BD%E4%BB%A4%E5%A4%87%E5%BF%98%E5%BD%95docker/><link crossorigin=anonymous href=/assets/css/stylesheet.5ed58f4ac5cb2b1025742e6161056c468c3232b9bfc72705b7f9f2da355ff7f3.css integrity="sha256-XtWPSsXLKxAldC5hYQVsRowyMrm/xycFt/ny2jVf9/M=" rel="preload stylesheet" as=style><link rel=icon href=https://luanrz.github.io/images/icon.jpg><link rel=icon type=image/png sizes=16x16 href=https://luanrz.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://luanrz.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://luanrz.github.io/apple-touch-icon.png><link rel=mask-icon href=https://luanrz.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://luanrz.github.io/posts/%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/%E5%91%BD%E4%BB%A4%E5%A4%87%E5%BF%98%E5%BD%95docker/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script>const loadScript=(e,t)=>{var n=document.createElement("script");n.onerror=e=>{throw new URIError("The script "+e.target.src+" didn't load correctly.")},t&&(n.onload=t),document.head.insertAdjacentElement("beforeend",n),n.src=e},loadPlantUMLOnNeed=()=>{let e="language-plantuml";document.querySelectorAll("[class^="+e+"]").length>0&&loadScript("https://fastly.jsdelivr.net/gh/jmnote/plantuml-encoder@1.2.4/dist/plantuml-encoder.min.js",()=>{(function(){Array.prototype.forEach.call(document.querySelectorAll("[class^="+e+"]"),function(e){let t=document.createElement("IMG");t.loading="lazy",t.src="http://www.plantuml.com/plantuml/svg/~1"+plantumlEncoder.encode(e.innerText),e.parentNode.insertBefore(t,e),e.style.display="none"})})(),console.log("PlantUML init done")})};window.addEventListener("load",function(){loadPlantUMLOnNeed()})</script><meta property="og:url" content="https://luanrz.github.io/posts/%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/%E5%91%BD%E4%BB%A4%E5%A4%87%E5%BF%98%E5%BD%95docker/"><meta property="og:site_name" content="luanrz's blog"><meta property="og:title" content="命令备忘录：Docker"><meta property="og:description" content='Redis docker run \ -d \ -p 127.0.0.1:6379:6379 \ --name=redis \ redis docker-compose.yml
services: redis: image: redis container_name: redis ports: - "127.0.0.1:6379:6379" Nginx mkdir -p ./html/ mkdir -p ./conf.d/ mkdir -p ./log/ cat > ./html/index.html << EOF Hello World! EOF cat > ./conf.d/default.conf << EOF server { listen 80; location / { root /usr/share/nginx/html; index index.html index.htm; } } EOF docker run \ -d \ -p 127.0.0.1:8014:80 \ --name=nginx \ -v ./html/:/usr/share/nginx/html/ \ -v ./conf.d/:/etc/nginx/conf.d/ \ -v ./log/:/var/log/nginx/ \ nginx:alpine docker-compose.yml'><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-12-29T17:42:00+08:00"><meta property="article:modified_time" content="2025-12-29T17:42:00+08:00"><meta property="article:tag" content="Linux"><meta property="article:tag" content="命令备忘录"><meta property="article:tag" content="Docker"><meta name=twitter:card content="summary"><meta name=twitter:title content="命令备忘录：Docker"><meta name=twitter:description content='Redis
docker run \
-d \
-p 127.0.0.1:6379:6379 \
--name=redis \
redis

docker-compose.yml

services:
  redis:
    image: redis
    container_name: redis
    ports:
      - "127.0.0.1:6379:6379"
Nginx
mkdir -p ./html/
mkdir -p ./conf.d/
mkdir -p ./log/

cat > ./html/index.html << EOF
Hello World!
EOF

cat > ./conf.d/default.conf << EOF
server {
    listen       80;
    location / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
    }
}
EOF
docker run \
-d \
-p 127.0.0.1:8014:80 \
--name=nginx \
-v ./html/:/usr/share/nginx/html/ \
-v ./conf.d/:/etc/nginx/conf.d/ \
-v ./log/:/var/log/nginx/ \
nginx:alpine

docker-compose.yml'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://luanrz.github.io/posts/"},{"@type":"ListItem","position":3,"name":"命令备忘录：Docker","item":"https://luanrz.github.io/posts/%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/%E5%91%BD%E4%BB%A4%E5%A4%87%E5%BF%98%E5%BD%95docker/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"命令备忘录：Docker","name":"命令备忘录：Docker","description":"Redis docker run \\ -d \\ -p 127.0.0.1:6379:6379 \\ --name=redis \\ redis docker-compose.yml\nservices: redis: image: redis container_name: redis ports: - \u0026#34;127.0.0.1:6379:6379\u0026#34; Nginx mkdir -p ./html/ mkdir -p ./conf.d/ mkdir -p ./log/ cat \u0026gt; ./html/index.html \u0026lt;\u0026lt; EOF Hello World! EOF cat \u0026gt; ./conf.d/default.conf \u0026lt;\u0026lt; EOF server { listen 80; location / { root /usr/share/nginx/html; index index.html index.htm; } } EOF docker run \\ -d \\ -p 127.0.0.1:8014:80 \\ --name=nginx \\ -v ./html/:/usr/share/nginx/html/ \\ -v ./conf.d/:/etc/nginx/conf.d/ \\ -v ./log/:/var/log/nginx/ \\ nginx:alpine docker-compose.yml\n","keywords":["Linux","命令备忘录","Docker"],"articleBody":"Redis docker run \\ -d \\ -p 127.0.0.1:6379:6379 \\ --name=redis \\ redis docker-compose.yml\nservices: redis: image: redis container_name: redis ports: - \"127.0.0.1:6379:6379\" Nginx mkdir -p ./html/ mkdir -p ./conf.d/ mkdir -p ./log/ cat \u003e ./html/index.html \u003c\u003c EOF Hello World! EOF cat \u003e ./conf.d/default.conf \u003c\u003c EOF server { listen 80; location / { root /usr/share/nginx/html; index index.html index.htm; } } EOF docker run \\ -d \\ -p 127.0.0.1:8014:80 \\ --name=nginx \\ -v ./html/:/usr/share/nginx/html/ \\ -v ./conf.d/:/etc/nginx/conf.d/ \\ -v ./log/:/var/log/nginx/ \\ nginx:alpine docker-compose.yml\nservices: nginx: image: nginx:alpine container_name: nginx ports: - \"127.0.0.1:8014:80\" volumes: - ./html:/usr/share/nginx/html/ - ./conf.d:/etc/nginx/conf.d/ - ./log:/var/log/nginx/ html/index.html\nHello World! conf.d/default.conf\nserver { listen 80; location / { root /usr/share/nginx/html; index index.html index.htm; } } MySQL docker network create mysql mkdir -p ./data/ docker run \\ -d \\ --name=mysql \\ -p 127.0.0.1:3306:3306 \\ --net mysql \\ -e MYSQL_ROOT_PASSWORD=Passw0rd \\ -e MYSQL_DATABASE=mydb \\ -e MYSQL_USER=luanrz \\ -e MYSQL_PASSWORD=Passw0rd \\ -v ./data/:/var/lib/mysql/ \\ mysql docker run \\ -d \\ --name phpmyadmin \\ -p 127.0.0.1:8016:80 \\ --net mysql \\ -e PMA_HOST=mysql \\ -e PMA_USER=root \\ -e PMA_PASSWORD=Passw0rd \\ phpmyadmin docker-compose.yml\nservices: mysql: image: mysql container_name: mysql restart: unless-stopped ports: - \"127.0.0.1:3306:3306\" environment: - MYSQL_ROOT_PASSWORD=Passw0rd - MYSQL_DATABASE=mydb - MYSQL_USER=luanrz - MYSQL_PASSWORD=Passw0rd volumes: - ./data/:/var/lib/mysql/ networks: - mysql phpmyadmin: image: phpmyadmin container_name: phpmyadmin restart: unless-stopped ports: - \"127.0.0.1:8016:80\" environment: - PMA_HOST=mysql - PMA_USER=root - PMA_PASSWORD=Passw0rd depends_on: - mysql networks: - mysql networks: mysql: name: mysql driver: bridge XXL-JOB mkdir -p ./log/ docker run \\ -d \\ --name xxl-job-admin \\ -p 127.0.0.1:8024:8080 \\ --net mysql \\ -e PARAMS=\"--spring.datasource.url=jdbc:mysql://mysql:3306/xxl_job?useUnicode=true\u0026characterEncoding=UTF-8\u0026autoReconnect=true\u0026serverTimezone=Asia/Shanghai --spring.datasource.password=Passw0rd\" \\ -v ./log/:/data/applogs/xxl-job/ \\ xuxueli/xxl-job-admin:2.4.0 XXL-JOB依赖于MySQL，首次启动XXL-JOB时需要执行对应SQL。\ndocker-compose.yml\nservices: xxl-job-admin: image: xuxueli/xxl-job-admin:2.4.0 container_name: xxl-job-admin restart: unless-stopped ports: - \"127.0.0.1:8024:8080\" volumes: - ./log/:/data/applogs/xxl-job/ environment: PARAMS: \u003e- --spring.datasource.url=jdbc:mysql://mysql:3306/xxl_job?useUnicode=true\u0026characterEncoding=UTF-8\u0026autoReconnect=true\u0026serverTimezone=Asia/Shanghai --spring.datasource.password=Passw0rd networks: - mysql networks: mysql: name: mysql external: true ELK 参见ElasticSearch官方文档、Kibana官方文档、LogStash官方文档、Kafka镜像仓库、Filebeat官方文档\n# 初始化镜像与网络 docker pull docker.elastic.co/elasticsearch/elasticsearch:7.10.2 docker pull docker.elastic.co/kibana/kibana:7.10.2 docker pull docker.elastic.co/logstash/logstash:7.10.2 docker pull apache/kafka:4.1.1 docker pull docker.elastic.co/beats/filebeat:7.10.2 docker network create elastic # 初始化目录 mkdir -p elasticsearch/data logstash/config logstash/log filebeat/config filebeat/log # 目录权限变更（elastic容器的uid:gid默认为1000:1000） chown -R 1000:1000 elasticsearch/data ElasticSearch （1）启动ElasticSearch容器\ndocker run \\ -d \\ --name elasticsearch01 \\ -p 127.0.0.1:9200:9200 \\ --net elastic \\ -e discovery.type=single-node \\ -e xpack.security.enabled=true \\ -e \"ELASTIC_PASSWORD=Passw0rd\" \\ -v ./elasticsearch/data/:/usr/share/elasticsearch/data/ \\ -m 1GB \\ docker.elastic.co/elasticsearch/elasticsearch:7.10.2 （2）设置ES密码\n可选，如果在这里设置了ES密码，上述ELASTIC_PASSWORD=Passw0rd配置将会失效。执行下述命令需要配置xpack.security.enabled=true。\ndocker exec -it elasticsearch01 /usr/share/elasticsearch/bin/elasticsearch-setup-passwords auto Kibana （1）启动Kibana容器\ndocker run \\ -d \\ --name kibana01 \\ -p 127.0.0.1:5601:5601 \\ --net elastic \\ -e ELASTICSEARCH_HOSTS=http://elasticsearch01:9200 \\ -e ELASTICSEARCH_USERNAME=elastic \\ -e ELASTICSEARCH_PASSWORD=Passw0rd \\ -m 0.5GB \\ docker.elastic.co/kibana/kibana:7.10.2 ELASTICSEARCH_PASSWORD从上一步ElasticSearch配置中获取。\nLogStash （1）创建logstash.yml配置文件\ncat \u003e ./logstash/config/logstash.yml \u003c\u003c EOF http.host: \"0.0.0.0\" xpack.monitoring.elasticsearch.hosts: [ \"http://elasticsearch01:9200\" ] xpack.monitoring.elasticsearch.username: \"elastic\" xpack.monitoring.elasticsearch.password: \"Passw0rd\" EOF （2）创建logstash.conf配置文件\ncat \u003e ./logstash/config/logstash.conf \u003c\u003c EOF input { file { path =\u003e \"/var/log/logstash/*.log\" start_position =\u003e \"beginning\" codec =\u003e multiline { pattern =\u003e \"[#%\u0026*^]\" negate =\u003e false what =\u003e \"next\" } } } output { # 输出ES elasticsearch { hosts =\u003e [\"http://elasticsearch01:9200\"] index =\u003e \"log-%{+YYYY.MM.dd}\" user =\u003e \"elastic\" password =\u003e \"Passw0rd\" } # 输出到控制台 stdout { codec =\u003e rubydebug } } EOF （3）启动LogStash容器\ndocker run \\ -d \\ --name logstash01 \\ --net elastic \\ -v ./logstash/config/logstash.yml:/usr/share/logstash/config/logstash.yml \\ -v ./logstash/config/logstash.conf:/usr/share/logstash/pipeline/logstash.conf \\ -v ./logstash/log/:/var/log/logstash/ \\ -m 1GB \\ docker.elastic.co/logstash/logstash:7.10.2 （4）验证LogStash\necho -e \"[#%\u0026*^]666\" \u003e\u003e ./logstash/log/1.log docker exec -it logstash01 bash curl -X GET \"http://elasticsearch01:9200/_search/\" \\ -H 'Content-Type: application/json' \\ -u 'elastic:Passw0rd' \\ -d '{ \"query\": { \"match\": { \"message\": \"666\" } } }' Kafka （1）启动Kafka容器\ndocker run \\ -d \\ --name kafka01 \\ -p 127.0.0.1:9094:9094 \\ --net elastic \\ -e KAFKA_PROCESS_ROLES=broker,controller \\ -e KAFKA_NODE_ID=1 \\ -e KAFKA_CONTROLLER_QUORUM_VOTERS=1@kafka01:9093 \\ -e KAFKA_LISTENERS=INTERNAL://:9092,CONTROLLER://:9093,EXTERNAL://:9094 \\ -e KAFKA_ADVERTISED_LISTENERS=INTERNAL://kafka01:9092,EXTERNAL://localhost:9094 \\ -e KAFKA_INTER_BROKER_LISTENER_NAME=INTERNAL \\ -e KAFKA_CONTROLLER_LISTENER_NAMES=CONTROLLER \\ -e KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=INTERNAL:PLAINTEXT,CONTROLLER:PLAINTEXT,EXTERNAL:PLAINTEXT \\ -e KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR=1 \\ -m 1GB \\ apache/kafka:4.1.1 为了同时支持在容器内部和宿主机外部访问Kafka，可为KAFKA_ADVERTISED_LISTENERS指定两个监听器：INTERNAL与EXTERNAL。一旦配置该参数，就不会使用默认配置（/opt/kafka/config/server.properties）了，上述其它-e参数都得加上，不然会启动报错。\n单节点模式需配置KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR为1，不然会启动报错。\n（2）验证Kafka\n# 进入Kafka容器 docker exec --workdir /opt/kafka/bin/ -it kafka01 bash # 创建Topic ./kafka-topics.sh --bootstrap-server localhost:9092 --create --topic elastic-topic # 使用Producer ./kafka-console-producer.sh --bootstrap-server localhost:9092 --topic elastic-topic \u003c\u003c\u003c \"[#%\u0026*^]666\" # 使用Consumer ./kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic elastic-topic --from-beginning （3）集成LogStash：将Kafka数据推送到LogStash\n修改logstash.conf配置文件（参见LogStash）的input内容：\ninput { kafka { bootstrap_servers =\u003e \"kafka01:9092\" topics =\u003e [\"elastic-topic\"] group_id =\u003e \"logstash-consumer-group\" decorate_events =\u003e true codec =\u003e \"json\" } } 完整配置如下：\ncat \u003e ./logstash/config/logstash.conf \u003c\u003c EOF input { kafka { bootstrap_servers =\u003e \"kafka01:9092\" topics =\u003e [\"elastic-topic\"] group_id =\u003e \"logstash-consumer-group\" decorate_events =\u003e true codec =\u003e \"json\" } } output { # 输出ES elasticsearch { hosts =\u003e [\"http://elasticsearch01:9200\"] index =\u003e \"log-%{+YYYY.MM.dd}\" user =\u003e \"elastic\" password =\u003e \"Passw0rd\" } # 输出到控制台 stdout { codec =\u003e rubydebug } } EOF 重启LogStash，使用kafka-producer生成日志（json格式），在Kibana中验证日志是否写入成功。\nFilebeat （1）创建filebeat.yml配置文件\ncat \u003e ./filebeat/config/filebeat.yml \u003c\u003c EOF filebeat.inputs: - type: log enabled: true paths: - /var/log/filebeat/*.log output.elasticsearch: hosts: 'elasticsearch01:9200' username: 'elastic' password: 'Passw0rd' EOF （2）启动Filebeat容器\ndocker run \\ -d \\ --name filebeat01 \\ --net elastic \\ -v ./filebeat/config/filebeat.yml:/usr/share/filebeat/filebeat.yml:ro \\ -v ./filebeat/log/:/var/log/filebeat/:ro \\ -m 0.1GB \\ docker.elastic.co/beats/filebeat:7.10.2 （3）验证Filebeat\necho -e \"[#%\u0026*^]666\" \u003e\u003e ./filebeat/log/1.log docker exec -it filebeat01 bash curl -X GET \"http://elasticsearch01:9200/_search/\" \\ -H 'Content-Type: application/json' \\ -u 'elastic:Passw0rd' \\ -d '{ \"query\": { \"match\": { \"message\": \"666\" } } }' （4）集成Kafka：将Filebeat数据推送到Kafka\n修改logstash.yml配置文件的output内容：\noutput.kafka: hosts: ['kafka01:9092'] topic: \"elastic-topic\" group_id =\u003e \"elastic-consumer-group\" decorate_events =\u003e true codec =\u003e \"json\" 另外，为了兼容日志含有换行符的情况，增加input的multiline配置：\nfilebeat.inputs: - type: log enabled: true paths: - /var/log/filebeat/*.log multiline: pattern: '[#%\u0026*^]' negate: true match: after 完整配置如下：\ncat \u003e ./filebeat/config/filebeat.yml \u003c\u003c EOF filebeat.inputs: - type: log enabled: true paths: - /var/log/filebeat/*.log multiline: pattern: '[#%\u0026*^]' negate: true match: after output.kafka: hosts: ['kafka01:9092'] topic: \"elastic-topic\" EOF 重启Filebeat，往filebeat/log/下写入任意日志，在Kafka中验证日志是否写入成功。\n最后，可启动对应的ELK容器，验证常用的ELK调用链路：\nLogStash -\u003e ElasticSearch -\u003e Kibana Filebeat -\u003e ElasticSearch -\u003e Kibana Filebeat -\u003e Kafka -\u003e LogStash -\u003e ElasticSearch -\u003e Kibana ELK Compose docker-compose.yml\nservices: elasticsearch01: image: docker.elastic.co/elasticsearch/elasticsearch:7.10.2 container_name: elasticsearch01 ports: - \"127.0.0.1:9200:9200\" environment: - discovery.type=single-node - xpack.security.enabled=true - ELASTIC_PASSWORD=Passw0rd volumes: - ./elasticsearch/data/:/usr/share/elasticsearch/data/ deploy: resources: limits: memory: 1GB networks: - elastic kibana01: image: docker.elastic.co/kibana/kibana:7.10.2 container_name: kibana01 ports: - \"127.0.0.1:5601:5601\" environment: - ELASTICSEARCH_HOSTS=http://elasticsearch01:9200 - ELASTICSEARCH_USERNAME=elastic - ELASTICSEARCH_PASSWORD=Passw0rd depends_on: - elasticsearch01 deploy: resources: limits: memory: 0.5GB networks: - elastic logstash01: image: docker.elastic.co/logstash/logstash:7.10.2 container_name: logstash01 volumes: - ./logstash/config/logstash.yml:/usr/share/logstash/config/logstash.yml - ./logstash/config/logstash.conf:/usr/share/logstash/pipeline/logstash.conf - ./logstash/log/:/var/log/logstash/ depends_on: - elasticsearch01 - kafka01 deploy: resources: limits: memory: 1GB networks: - elastic kafka01: image: apache/kafka:4.1.1 container_name: kafka01 ports: - \"127.0.0.1:9094:9094\" environment: - KAFKA_PROCESS_ROLES=broker,controller - KAFKA_NODE_ID=1 - KAFKA_CONTROLLER_QUORUM_VOTERS=1@kafka01:9093 - KAFKA_LISTENERS=INTERNAL://:9092,CONTROLLER://:9093,EXTERNAL://:9094 - KAFKA_ADVERTISED_LISTENERS=INTERNAL://kafka01:9092,EXTERNAL://localhost:9094 - KAFKA_INTER_BROKER_LISTENER_NAME=INTERNAL - KAFKA_CONTROLLER_LISTENER_NAMES=CONTROLLER - KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=INTERNAL:PLAINTEXT,CONTROLLER:PLAINTEXT,EXTERNAL:PLAINTEXT - KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR=1 depends_on: - elasticsearch01 deploy: resources: limits: memory: 1GB networks: - elastic filebeat01: image: docker.elastic.co/beats/filebeat:7.10.2 container_name: filebeat01 volumes: - ./filebeat/config/filebeat.yml:/usr/share/filebeat/filebeat.yml:ro - ./filebeat/log/:/var/log/filebeat/:ro depends_on: - kafka01 deploy: resources: limits: memory: 0.1GB networks: - elastic networks: elastic: name: elastic driver: bridge filebeat/config/filebeat.yml\nfilebeat.inputs: - type: log enabled: true paths: - /var/log/filebeat/*.log multiline: pattern: '[#%\u0026*^]' negate: true match: after output.kafka: hosts: ['kafka01:9092'] topic: \"elastic-topic\" logstash/config/logstash.yml\nhttp.host: \"0.0.0.0\" xpack.monitoring.elasticsearch.hosts: [ \"http://elasticsearch01:9200\" ] xpack.monitoring.elasticsearch.username: \"elastic\" xpack.monitoring.elasticsearch.password: \"Passw0rd\" ogstash/config/logstash.conf\ninput { kafka { bootstrap_servers =\u003e \"kafka01:9092\" topics =\u003e [\"elastic-topic\"] group_id =\u003e \"logstash-consumer-group\" decorate_events =\u003e true codec =\u003e \"json\" } } output { # 输出ES elasticsearch { hosts =\u003e [\"http://elasticsearch01:9200\"] index =\u003e \"log-%{+YYYY.MM.dd}\" user =\u003e \"elastic\" password =\u003e \"Passw0rd\" } # 输出到控制台 stdout { codec =\u003e rubydebug } } Windows 参见官方Github页面与这篇文章 。\n下载windows镜像文件（如：Windows 10 LTSC），重命名为boot.iso，放到当前目录。\ndocker run \\ -it \\ --name windows \\ -p 127.0.0.1:8006:8006 \\ -p 127.0.0.1:3389:3389/tcp \\ -p 127.0.0.1:3389:3389/udp \\ -e VERSION=\"./boot.iso\" \\ -e RAM_SIZE=\"2G\" \\ -e CPU_CORES=\"2\" \\ -e DISK_SIZE=\"32G\" \\ -e USERNAME=\"luanrz\" \\ -e PASSWORD=\"Passw0rd\" \\ -v ./boot.iso:/boot.iso \\ -v ./storage/:/storage/ \\ -v ./data/:/data/ \\ --device=/dev/kvm \\ --device=/dev/net/tun \\ --cap-add NET_ADMIN \\ --stop-timeout 120 \\ dockurr/windows 在浏览器中访问http://127.0.0.1:8006，执行windows安装流程。安装完成后开启远程桌面访问，后续可通过Remmina等支持RDP协议的工具连接3389端口访问远程桌面。\ndocker-compose.yml\nservices: windows: image: dockurr/windows container_name: windows environment: VERSION: \"./boot.iso\" RAM_SIZE: \"2G\" CPU_CORES: \"2\" DISK_SIZE: \"32G\" USERNAME: \"luanrz\" PASSWORD: \"Passw0rd\" ports: - 127.0.0.1:8006:8006 - 127.0.0.1:3389:3389/tcp - 127.0.0.1:3389:3389/udp volumes: - ./boot.iso:/boot.iso - ./storage/:/storage/ - ./data/:/data/ devices: - /dev/kvm - /dev/net/tun cap_add: - NET_ADMIN restart: on-failure stop_grace_period: 2m ","wordCount":"2384","inLanguage":"zh","datePublished":"2025-12-29T17:42:00+08:00","dateModified":"2025-12-29T17:42:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://luanrz.github.io/posts/%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/%E5%91%BD%E4%BB%A4%E5%A4%87%E5%BF%98%E5%BD%95docker/"},"publisher":{"@type":"Organization","name":"luanrz's blog","logo":{"@type":"ImageObject","url":"https://luanrz.github.io/images/icon.jpg"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://luanrz.github.io/ accesskey=h title="luanrz's blog (Alt + H)">luanrz's blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://luanrz.github.io/ title=首页><span>首页</span></a></li><li><a href=https://luanrz.github.io/search/ title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=https://luanrz.github.io/archives/ title=归档><span>归档</span></a></li><li><a href=https://luanrz.github.io/categories/ title=分类><span>分类</span></a></li><li><a href=https://luanrz.github.io/tags/ title=标签><span>标签</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">命令备忘录：Docker</h1><div class=post-meta><span title='2025-12-29 17:42:00 +0800 +0800'>2025-12-29</span>&nbsp;·&nbsp;<span>5 分钟</span>&nbsp;·&nbsp;<span>2384 字</span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#redis aria-label=Redis>Redis</a></li><li><a href=#nginx aria-label=Nginx>Nginx</a></li><li><a href=#mysql aria-label=MySQL>MySQL</a></li><li><a href=#xxl-job aria-label=XXL-JOB>XXL-JOB</a></li><li><a href=#elk aria-label=ELK>ELK</a><ul><li><a href=#elasticsearch aria-label=ElasticSearch>ElasticSearch</a></li><li><a href=#kibana aria-label=Kibana>Kibana</a></li><li><a href=#logstash aria-label=LogStash>LogStash</a></li><li><a href=#kafka aria-label=Kafka>Kafka</a></li><li><a href=#filebeat aria-label=Filebeat>Filebeat</a></li><li><a href=#elk-compose aria-label="ELK Compose">ELK Compose</a></li></ul></li><li><a href=#windows aria-label=Windows>Windows</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=redis>Redis<a hidden class=anchor aria-hidden=true href=#redis>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>docker run <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-d <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-p 127.0.0.1:6379:6379 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>--name<span style=color:#f92672>=</span>redis <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>redis
</span></span></code></pre></div><blockquote><p>docker-compose.yml</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>redis</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>redis</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>redis</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;127.0.0.1:6379:6379&#34;</span>
</span></span></code></pre></div><h2 id=nginx>Nginx<a hidden class=anchor aria-hidden=true href=#nginx>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>mkdir -p ./html/
</span></span><span style=display:flex><span>mkdir -p ./conf.d/
</span></span><span style=display:flex><span>mkdir -p ./log/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat &gt; ./html/index.html <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Hello World!
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat &gt; ./conf.d/default.conf <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>server {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    listen       80;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    location / {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        root   /usr/share/nginx/html;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        index  index.html index.htm;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>docker run <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-d <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-p 127.0.0.1:8014:80 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>--name<span style=color:#f92672>=</span>nginx <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-v ./html/:/usr/share/nginx/html/ <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-v ./conf.d/:/etc/nginx/conf.d/ <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-v ./log/:/var/log/nginx/ <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>nginx:alpine
</span></span></code></pre></div><blockquote><p>docker-compose.yml</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>nginx</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:alpine</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;127.0.0.1:8014:80&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./html:/usr/share/nginx/html/</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./conf.d:/etc/nginx/conf.d/</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./log:/var/log/nginx/</span>
</span></span></code></pre></div><blockquote><p>html/index.html</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-html data-lang=html><span style=display:flex><span>Hello World!
</span></span></code></pre></div><blockquote><p>conf.d/default.conf</p></blockquote><pre tabindex=0><code class=language-conf data-lang=conf>server {
    listen       80;
    location / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
    }
}
</code></pre><h2 id=mysql>MySQL<a hidden class=anchor aria-hidden=true href=#mysql>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>docker network create mysql
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mkdir -p ./data/ 
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>docker run <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-d <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>--name<span style=color:#f92672>=</span>mysql <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-p 127.0.0.1:3306:3306 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>--net mysql <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e MYSQL_ROOT_PASSWORD<span style=color:#f92672>=</span>Passw0rd <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e MYSQL_DATABASE<span style=color:#f92672>=</span>mydb <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e MYSQL_USER<span style=color:#f92672>=</span>luanrz <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e MYSQL_PASSWORD<span style=color:#f92672>=</span>Passw0rd <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-v ./data/:/var/lib/mysql/ <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>mysql
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>docker run <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-d <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>--name phpmyadmin <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-p 127.0.0.1:8016:80 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>--net mysql <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e PMA_HOST<span style=color:#f92672>=</span>mysql <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e PMA_USER<span style=color:#f92672>=</span>root <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e PMA_PASSWORD<span style=color:#f92672>=</span>Passw0rd <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>phpmyadmin
</span></span></code></pre></div><blockquote><p>docker-compose.yml</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>mysql</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>mysql</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>mysql</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;127.0.0.1:3306:3306&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>MYSQL_ROOT_PASSWORD=Passw0rd</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>MYSQL_DATABASE=mydb</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>MYSQL_USER=luanrz</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>MYSQL_PASSWORD=Passw0rd</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./data/:/var/lib/mysql/</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>mysql</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>phpmyadmin</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>phpmyadmin</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>phpmyadmin</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;127.0.0.1:8016:80&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>PMA_HOST=mysql</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>PMA_USER=root</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>PMA_PASSWORD=Passw0rd</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>depends_on</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>mysql</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>mysql</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>mysql</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>mysql</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver</span>: <span style=color:#ae81ff>bridge</span>
</span></span></code></pre></div><h2 id=xxl-job>XXL-JOB<a hidden class=anchor aria-hidden=true href=#xxl-job>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>mkdir -p ./log/ 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker run <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-d <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>--name xxl-job-admin <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-p 127.0.0.1:8024:8080 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>--net mysql <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e PARAMS<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;--spring.datasource.url=jdbc:mysql://mysql:3306/xxl_job?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai --spring.datasource.password=Passw0rd&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-v ./log/:/data/applogs/xxl-job/ <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>xuxueli/xxl-job-admin:2.4.0
</span></span></code></pre></div><blockquote><p>XXL-JOB依赖于<a href=#mysql>MySQL</a>，首次启动<code>XXL-JOB</code>时需要执行<a href=https://github.com/xuxueli/xxl-job/blob/2.4.0/doc/db/tables_xxl_job.sql>对应SQL</a>。</p></blockquote><blockquote><p>docker-compose.yml</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>xxl-job-admin</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>xuxueli/xxl-job-admin:2.4.0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>xxl-job-admin</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;127.0.0.1:8024:8080&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./log/:/data/applogs/xxl-job/</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>PARAMS</span>: &gt;-<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        --spring.datasource.url=jdbc:mysql://mysql:3306/xxl_job?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        --spring.datasource.password=Passw0rd</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>mysql</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>mysql</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>mysql</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>external</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><h2 id=elk>ELK<a hidden class=anchor aria-hidden=true href=#elk>#</a></h2><blockquote><p>参见<a href=https://www.elastic.co/docs/deploy-manage/deploy/self-managed/install-elasticsearch-docker-basic>ElasticSearch官方文档</a>、<a href=https://www.elastic.co/docs/deploy-manage/deploy/self-managed/install-kibana-with-docker>Kibana官方文档</a>、<a href=https://www.elastic.co/docs/reference/logstash/docker-config>LogStash官方文档</a>、<a href=https://1ms.run/r/apache/kafka>Kafka镜像仓库</a>、<a href=https://www.elastic.co/docs/reference/beats/filebeat/running-on-docker>Filebeat官方文档</a></p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 初始化镜像与网络</span>
</span></span><span style=display:flex><span>docker pull docker.elastic.co/elasticsearch/elasticsearch:7.10.2
</span></span><span style=display:flex><span>docker pull docker.elastic.co/kibana/kibana:7.10.2
</span></span><span style=display:flex><span>docker pull docker.elastic.co/logstash/logstash:7.10.2
</span></span><span style=display:flex><span>docker pull apache/kafka:4.1.1
</span></span><span style=display:flex><span>docker pull docker.elastic.co/beats/filebeat:7.10.2
</span></span><span style=display:flex><span>docker network create elastic
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 初始化目录</span>
</span></span><span style=display:flex><span>mkdir -p elasticsearch/data logstash/config logstash/log filebeat/config filebeat/log
</span></span><span style=display:flex><span><span style=color:#75715e># 目录权限变更（elastic容器的uid:gid默认为1000:1000）</span>
</span></span><span style=display:flex><span>chown -R 1000:1000 elasticsearch/data
</span></span></code></pre></div><h3 id=elasticsearch>ElasticSearch<a hidden class=anchor aria-hidden=true href=#elasticsearch>#</a></h3><p>（1）启动ElasticSearch容器</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>docker run <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-d <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>--name elasticsearch01 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-p 127.0.0.1:9200:9200 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>--net elastic <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e discovery.type<span style=color:#f92672>=</span>single-node <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e xpack.security.enabled<span style=color:#f92672>=</span>true <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e <span style=color:#e6db74>&#34;ELASTIC_PASSWORD=Passw0rd&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-v ./elasticsearch/data/:/usr/share/elasticsearch/data/ <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-m 1GB <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>docker.elastic.co/elasticsearch/elasticsearch:7.10.2
</span></span></code></pre></div><p>（2）设置ES密码</p><blockquote><p>可选，如果在这里设置了ES密码，上述<code>ELASTIC_PASSWORD=Passw0rd</code>配置将会失效。执行下述命令需要配置<code>xpack.security.enabled=true</code>。</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>docker exec -it elasticsearch01 /usr/share/elasticsearch/bin/elasticsearch-setup-passwords auto
</span></span></code></pre></div><h3 id=kibana>Kibana<a hidden class=anchor aria-hidden=true href=#kibana>#</a></h3><p>（1）启动Kibana容器</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>docker run <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-d <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>--name kibana01 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-p 127.0.0.1:5601:5601 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>--net elastic <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e ELASTICSEARCH_HOSTS<span style=color:#f92672>=</span>http://elasticsearch01:9200 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e ELASTICSEARCH_USERNAME<span style=color:#f92672>=</span>elastic <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e ELASTICSEARCH_PASSWORD<span style=color:#f92672>=</span>Passw0rd <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-m 0.5GB <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>docker.elastic.co/kibana/kibana:7.10.2 
</span></span></code></pre></div><blockquote><p><code>ELASTICSEARCH_PASSWORD</code>从上一步<a href=#elasticsearch>ElasticSearch</a>配置中获取。</p></blockquote><h3 id=logstash>LogStash<a hidden class=anchor aria-hidden=true href=#logstash>#</a></h3><p>（1）创建logstash.yml配置文件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>cat &gt; ./logstash/config/logstash.yml <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>http.host: &#34;0.0.0.0&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>xpack.monitoring.elasticsearch.hosts: [ &#34;http://elasticsearch01:9200&#34; ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>xpack.monitoring.elasticsearch.username: &#34;elastic&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>xpack.monitoring.elasticsearch.password: &#34;Passw0rd&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><p>（2）创建logstash.conf配置文件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>cat &gt; ./logstash/config/logstash.conf <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>input {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  file {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    path =&gt; &#34;/var/log/logstash/*.log&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    start_position =&gt; &#34;beginning&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    codec =&gt; multiline {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      pattern =&gt; &#34;[#%&amp;*^]&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      negate =&gt; false
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      what =&gt; &#34;next&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>output {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  # 输出ES
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  elasticsearch {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    hosts =&gt; [&#34;http://elasticsearch01:9200&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    index =&gt; &#34;log-%{+YYYY.MM.dd}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    user =&gt; &#34;elastic&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    password =&gt; &#34;Passw0rd&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  # 输出到控制台
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  stdout {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    codec =&gt; rubydebug
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  }  
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><p>（3）启动LogStash容器</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>docker run <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-d <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>--name logstash01 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>--net elastic <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-v ./logstash/config/logstash.yml:/usr/share/logstash/config/logstash.yml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-v ./logstash/config/logstash.conf:/usr/share/logstash/pipeline/logstash.conf <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-v ./logstash/log/:/var/log/logstash/ <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-m 1GB <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>docker.elastic.co/logstash/logstash:7.10.2
</span></span></code></pre></div><p>（4）验证LogStash</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>echo -e <span style=color:#e6db74>&#34;[#%&amp;*^]666&#34;</span> &gt;&gt; ./logstash/log/1.log
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker exec -it logstash01 bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>curl -X GET <span style=color:#e6db74>&#34;http://elasticsearch01:9200/_search/&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-H <span style=color:#e6db74>&#39;Content-Type: application/json&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-u <span style=color:#e6db74>&#39;elastic:Passw0rd&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-d <span style=color:#e6db74>&#39;{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;query&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;match&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;message&#34;: &#34;666&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}&#39;</span>
</span></span></code></pre></div><h3 id=kafka>Kafka<a hidden class=anchor aria-hidden=true href=#kafka>#</a></h3><p>（1）启动Kafka容器</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>docker run <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-d <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>--name kafka01 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-p 127.0.0.1:9094:9094 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>--net elastic <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e KAFKA_PROCESS_ROLES<span style=color:#f92672>=</span>broker,controller <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e KAFKA_NODE_ID<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e KAFKA_CONTROLLER_QUORUM_VOTERS<span style=color:#f92672>=</span>1@kafka01:9093 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e KAFKA_LISTENERS<span style=color:#f92672>=</span>INTERNAL://:9092,CONTROLLER://:9093,EXTERNAL://:9094 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e KAFKA_ADVERTISED_LISTENERS<span style=color:#f92672>=</span>INTERNAL://kafka01:9092,EXTERNAL://localhost:9094 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e KAFKA_INTER_BROKER_LISTENER_NAME<span style=color:#f92672>=</span>INTERNAL <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e KAFKA_CONTROLLER_LISTENER_NAMES<span style=color:#f92672>=</span>CONTROLLER <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e KAFKA_LISTENER_SECURITY_PROTOCOL_MAP<span style=color:#f92672>=</span>INTERNAL:PLAINTEXT,CONTROLLER:PLAINTEXT,EXTERNAL:PLAINTEXT <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-m 1GB <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>apache/kafka:4.1.1
</span></span></code></pre></div><blockquote><p>为了同时支持在容器内部和宿主机外部访问Kafka，可为<code>KAFKA_ADVERTISED_LISTENERS</code>指定两个监听器：INTERNAL与EXTERNAL。一旦配置该参数，就不会使用默认配置（<code>/opt/kafka/config/server.properties</code>）了，上述其它<code>-e</code>参数都得加上，不然会启动报错。</p></blockquote><blockquote><p>单节点模式需配置<code>KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR</code>为1，不然会启动报错。</p></blockquote><p>（2）验证Kafka</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 进入Kafka容器</span>
</span></span><span style=display:flex><span>docker exec --workdir /opt/kafka/bin/ -it kafka01 bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 创建Topic</span>
</span></span><span style=display:flex><span>./kafka-topics.sh --bootstrap-server localhost:9092 --create --topic elastic-topic
</span></span><span style=display:flex><span><span style=color:#75715e># 使用Producer</span>
</span></span><span style=display:flex><span>./kafka-console-producer.sh --bootstrap-server localhost:9092 --topic elastic-topic <span style=color:#f92672>&lt;&lt;&lt;</span> <span style=color:#e6db74>&#34;[#%&amp;*^]666&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 使用Consumer</span>
</span></span><span style=display:flex><span>./kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic elastic-topic --from-beginning
</span></span></code></pre></div><p>（3）集成LogStash：将Kafka数据推送到LogStash</p><p>修改logstash.conf配置文件（参见<a href=#logstash>LogStash</a>）的input内容：</p><pre tabindex=0><code>input {
  kafka {
    bootstrap_servers =&gt; &#34;kafka01:9092&#34;
    topics =&gt; [&#34;elastic-topic&#34;]
    group_id =&gt; &#34;logstash-consumer-group&#34;
    decorate_events =&gt; true
    codec =&gt; &#34;json&#34;    
  }
}
</code></pre><p>完整配置如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>cat &gt; ./logstash/config/logstash.conf <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>input {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  kafka {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    bootstrap_servers =&gt; &#34;kafka01:9092&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    topics =&gt; [&#34;elastic-topic&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    group_id =&gt; &#34;logstash-consumer-group&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    decorate_events =&gt; true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    codec =&gt; &#34;json&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>output {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  # 输出ES
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  elasticsearch {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    hosts =&gt; [&#34;http://elasticsearch01:9200&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    index =&gt; &#34;log-%{+YYYY.MM.dd}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    user =&gt; &#34;elastic&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    password =&gt; &#34;Passw0rd&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  # 输出到控制台
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  stdout {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    codec =&gt; rubydebug
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  }  
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><p>重启LogStash，使用kafka-producer生成日志（json格式），在Kibana中验证日志是否写入成功。</p><h3 id=filebeat>Filebeat<a hidden class=anchor aria-hidden=true href=#filebeat>#</a></h3><p>（1）创建filebeat.yml配置文件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>cat &gt; ./filebeat/config/filebeat.yml <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>filebeat.inputs:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- type: log
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  enabled: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  paths:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - /var/log/filebeat/*.log
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>output.elasticsearch:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  hosts: &#39;elasticsearch01:9200&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  username: &#39;elastic&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  password: &#39;Passw0rd&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><p>（2）启动Filebeat容器</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>docker run <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-d <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>--name filebeat01 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>--net elastic <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-v ./filebeat/config/filebeat.yml:/usr/share/filebeat/filebeat.yml:ro <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-v ./filebeat/log/:/var/log/filebeat/:ro <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-m 0.1GB <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>docker.elastic.co/beats/filebeat:7.10.2
</span></span></code></pre></div><p>（3）验证Filebeat</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>echo -e <span style=color:#e6db74>&#34;[#%&amp;*^]666&#34;</span> &gt;&gt; ./filebeat/log/1.log
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker exec -it filebeat01 bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>curl -X GET <span style=color:#e6db74>&#34;http://elasticsearch01:9200/_search/&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-H <span style=color:#e6db74>&#39;Content-Type: application/json&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-u <span style=color:#e6db74>&#39;elastic:Passw0rd&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-d <span style=color:#e6db74>&#39;{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;query&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;match&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;message&#34;: &#34;666&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}&#39;</span>
</span></span></code></pre></div><p>（4）集成Kafka：将Filebeat数据推送到Kafka</p><p>修改logstash.yml配置文件的output内容：</p><pre tabindex=0><code>output.kafka:
  hosts: [&#39;kafka01:9092&#39;]
  topic: &#34;elastic-topic&#34;
  group_id =&gt; &#34;elastic-consumer-group&#34;
  decorate_events =&gt; true
  codec =&gt; &#34;json&#34;
</code></pre><p>另外，为了兼容日志含有换行符的情况，增加input的multiline配置：</p><pre tabindex=0><code>filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/filebeat/*.log
  multiline:
    pattern: &#39;[#%&amp;*^]&#39;
    negate: true
    match: after
</code></pre><p>完整配置如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>cat &gt; ./filebeat/config/filebeat.yml <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>filebeat.inputs:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- type: log
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  enabled: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  paths:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - /var/log/filebeat/*.log
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  multiline:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    pattern: &#39;[#%&amp;*^]&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    negate: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    match: after
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>output.kafka:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  hosts: [&#39;kafka01:9092&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  topic: &#34;elastic-topic&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><p>重启Filebeat，往<code>filebeat/log/</code>下写入任意日志，在Kafka中验证日志是否写入成功。</p><p>最后，可启动对应的ELK容器，验证常用的ELK调用链路：</p><ul><li>LogStash -> ElasticSearch -> Kibana</li><li>Filebeat -> ElasticSearch -> Kibana</li><li>Filebeat -> Kafka -> LogStash -> ElasticSearch -> Kibana</li></ul><h3 id=elk-compose>ELK Compose<a hidden class=anchor aria-hidden=true href=#elk-compose>#</a></h3><blockquote><p>docker-compose.yml</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>elasticsearch01</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>docker.elastic.co/elasticsearch/elasticsearch:7.10.2</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>elasticsearch01</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;127.0.0.1:9200:9200&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>discovery.type=single-node</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>xpack.security.enabled=true</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>ELASTIC_PASSWORD=Passw0rd</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./elasticsearch/data/:/usr/share/elasticsearch/data/      </span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>deploy</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>memory</span>: <span style=color:#ae81ff>1GB</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>elastic</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>kibana01</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>docker.elastic.co/kibana/kibana:7.10.2</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>kibana01</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;127.0.0.1:5601:5601&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>ELASTICSEARCH_HOSTS=http://elasticsearch01:9200</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>ELASTICSEARCH_USERNAME=elastic</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>ELASTICSEARCH_PASSWORD=Passw0rd</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>depends_on</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>elasticsearch01</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>deploy</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>memory</span>: <span style=color:#ae81ff>0.</span><span style=color:#ae81ff>5GB</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>elastic</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>logstash01</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>docker.elastic.co/logstash/logstash:7.10.2</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>logstash01</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./logstash/config/logstash.yml:/usr/share/logstash/config/logstash.yml</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./logstash/config/logstash.conf:/usr/share/logstash/pipeline/logstash.conf</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./logstash/log/:/var/log/logstash/</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>depends_on</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>elasticsearch01</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>kafka01</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>deploy</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>memory</span>: <span style=color:#ae81ff>1GB</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>elastic</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>kafka01</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>apache/kafka:4.1.1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>kafka01</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;127.0.0.1:9094:9094&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>KAFKA_PROCESS_ROLES=broker,controller</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>KAFKA_NODE_ID=1</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>KAFKA_CONTROLLER_QUORUM_VOTERS=1@kafka01:9093</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>KAFKA_LISTENERS=INTERNAL://:9092,CONTROLLER://:9093,EXTERNAL://:9094</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>KAFKA_ADVERTISED_LISTENERS=INTERNAL://kafka01:9092,EXTERNAL://localhost:9094</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>KAFKA_INTER_BROKER_LISTENER_NAME=INTERNAL</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>KAFKA_CONTROLLER_LISTENER_NAMES=CONTROLLER</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=INTERNAL:PLAINTEXT,CONTROLLER:PLAINTEXT,EXTERNAL:PLAINTEXT</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR=1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>depends_on</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>elasticsearch01</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>deploy</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>memory</span>: <span style=color:#ae81ff>1GB</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>elastic</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>filebeat01</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>docker.elastic.co/beats/filebeat:7.10.2</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>filebeat01</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./filebeat/config/filebeat.yml:/usr/share/filebeat/filebeat.yml:ro</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./filebeat/log/:/var/log/filebeat/:ro</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>depends_on</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>kafka01</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>deploy</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>memory</span>: <span style=color:#ae81ff>0.</span><span style=color:#ae81ff>1GB </span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>elastic</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>elastic</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>elastic</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver</span>: <span style=color:#ae81ff>bridge</span>
</span></span></code></pre></div><blockquote><p>filebeat/config/filebeat.yml</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>filebeat.inputs</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>type</span>: <span style=color:#ae81ff>log</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>paths</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>/var/log/filebeat/*.log</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>multiline</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>pattern</span>: <span style=color:#e6db74>&#39;[#%&amp;*^]&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>negate</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>match</span>: <span style=color:#ae81ff>after</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>output.kafka</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>hosts</span>: [<span style=color:#e6db74>&#39;kafka01:9092&#39;</span>]
</span></span><span style=display:flex><span>  <span style=color:#f92672>topic</span>: <span style=color:#e6db74>&#34;elastic-topic&#34;</span>
</span></span></code></pre></div><blockquote><p>logstash/config/logstash.yml</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>http.host</span>: <span style=color:#e6db74>&#34;0.0.0.0&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>xpack.monitoring.elasticsearch.hosts</span>: [ <span style=color:#e6db74>&#34;http://elasticsearch01:9200&#34;</span> ]
</span></span><span style=display:flex><span><span style=color:#f92672>xpack.monitoring.elasticsearch.username</span>: <span style=color:#e6db74>&#34;elastic&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>xpack.monitoring.elasticsearch.password</span>: <span style=color:#e6db74>&#34;Passw0rd&#34;</span>
</span></span></code></pre></div><blockquote><p>ogstash/config/logstash.conf</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-ruby data-lang=ruby><span style=display:flex><span>input {
</span></span><span style=display:flex><span>  kafka {
</span></span><span style=display:flex><span>    bootstrap_servers <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;kafka01:9092&#34;</span>
</span></span><span style=display:flex><span>    topics <span style=color:#f92672>=&gt;</span> <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;elastic-topic&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    group_id <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;logstash-consumer-group&#34;</span>
</span></span><span style=display:flex><span>    decorate_events <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    codec <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;json&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>output {
</span></span><span style=display:flex><span>  <span style=color:#75715e># 输出ES</span>
</span></span><span style=display:flex><span>  elasticsearch {
</span></span><span style=display:flex><span>    hosts <span style=color:#f92672>=&gt;</span> <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;http://elasticsearch01:9200&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    index <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;log-%{+YYYY.MM.dd}&#34;</span>
</span></span><span style=display:flex><span>    user <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;elastic&#34;</span>
</span></span><span style=display:flex><span>    password <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;Passw0rd&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># 输出到控制台</span>
</span></span><span style=display:flex><span>  stdout {
</span></span><span style=display:flex><span>    codec <span style=color:#f92672>=&gt;</span> rubydebug
</span></span><span style=display:flex><span>  }  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=windows>Windows<a hidden class=anchor aria-hidden=true href=#windows>#</a></h2><blockquote><p>参见<a href=https://github.com/dockur/windows>官方Github页面</a>与<a href=https://zhuanlan.zhihu.com/p/686351917>这篇文章
</a>。</p></blockquote><p>下载windows镜像文件（如：Windows 10 LTSC），重命名为<code>boot.iso</code>，放到当前目录。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-shell data-lang=shell><span style=display:flex><span>docker run <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-it <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>--name windows <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-p 127.0.0.1:8006:8006 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-p 127.0.0.1:3389:3389/tcp <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-p 127.0.0.1:3389:3389/udp <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e VERSION<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;./boot.iso&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e RAM_SIZE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;2G&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e CPU_CORES<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;2&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e DISK_SIZE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;32G&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e USERNAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;luanrz&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-e PASSWORD<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Passw0rd&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-v ./boot.iso:/boot.iso <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-v ./storage/:/storage/ <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>-v ./data/:/data/ <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>--device<span style=color:#f92672>=</span>/dev/kvm <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>--device<span style=color:#f92672>=</span>/dev/net/tun <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>--cap-add NET_ADMIN <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>--stop-timeout <span style=color:#ae81ff>120</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>dockurr/windows
</span></span></code></pre></div><p>在浏览器中访问<code>http://127.0.0.1:8006</code>，执行windows安装流程。安装完成后开启远程桌面访问，后续可通过<code>Remmina</code>等支持<code>RDP</code>协议的工具连接<code>3389</code>端口访问远程桌面。</p><blockquote><p>docker-compose.yml</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>windows</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>dockurr/windows</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>windows</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>VERSION</span>: <span style=color:#e6db74>&#34;./boot.iso&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>RAM_SIZE</span>: <span style=color:#e6db74>&#34;2G&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>CPU_CORES</span>: <span style=color:#e6db74>&#34;2&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DISK_SIZE</span>: <span style=color:#e6db74>&#34;32G&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>USERNAME</span>: <span style=color:#e6db74>&#34;luanrz&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>PASSWORD</span>: <span style=color:#e6db74>&#34;Passw0rd&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>127.0.0.1</span>:<span style=color:#ae81ff>8006</span>:<span style=color:#ae81ff>8006</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>127.0.0.1</span>:<span style=color:#ae81ff>3389</span>:<span style=color:#ae81ff>3389</span><span style=color:#ae81ff>/tcp</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>127.0.0.1</span>:<span style=color:#ae81ff>3389</span>:<span style=color:#ae81ff>3389</span><span style=color:#ae81ff>/udp</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./boot.iso:/boot.iso</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./storage/:/storage/</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./data/:/data/</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>devices</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/dev/kvm</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/dev/net/tun</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>cap_add</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>NET_ADMIN</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#66d9ef>on</span>-<span style=color:#ae81ff>failure</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>stop_grace_period</span>: <span style=color:#ae81ff>2m</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://luanrz.github.io/tags/linux/>Linux</a></li><li><a href=https://luanrz.github.io/tags/%E5%91%BD%E4%BB%A4%E5%A4%87%E5%BF%98%E5%BD%95/>命令备忘录</a></li><li><a href=https://luanrz.github.io/tags/docker/>Docker</a></li></ul><nav class=paginav><a class=next href=https://luanrz.github.io/posts/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/%E8%B7%A8%E5%B9%B3%E5%8F%B0ui%E6%A1%86%E6%9E%B6%E6%B1%87%E6%80%BB/><span class=title>下一页 »</span><br><span>跨平台UI框架汇总</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://luanrz.github.io/>luanrz's blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>